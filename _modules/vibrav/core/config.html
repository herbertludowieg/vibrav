<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>vibrav.core.config &#8212; vibrav  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/bootstrap-sphinx.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../../../_static/js/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="../../../_static/js/jquery-fix.js"></script>
<script type="text/javascript" src="../../../_static/bootstrap-3.4.1/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../../../_static/bootstrap-sphinx.js"></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../../index.html">
          vibrav</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/adf.html">ADF parser API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/gen-displaced.html">Generating the displaced structures from a Gaussian frequencies calculation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/molcas.html">Molcas parser API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/numerical-diffs.html">Using derivative module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/vibronic.html">Running vibronic calculations from a Molcas RASSI set of calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/vroa-h2o2.html">VROA intensities of hydrogen peroxide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/vroa-methyloxirane.html">VROA intensities of methyloxirane</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/zpvc.html">Tutorial for using the ZPVC module in VIBRAV</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../vibrav.html">vibrav package</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"></ul>
</li>
              
            
            
              
                
              
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <h1>Source code for vibrav.core.config</h1><div class="highlight"><pre>
<span></span><span class="c1"># This file is part of vibrav.</span>
<span class="c1">#</span>
<span class="c1"># vibrav is free software: you can redistribute it and/or modify</span>
<span class="c1"># it under the terms of the GNU General Public License as published by</span>
<span class="c1"># the Free Software Foundation, either version 3 of the License, or</span>
<span class="c1"># (at your option) any later version.</span>
<span class="c1">#</span>
<span class="c1"># vibrav is distributed in the hope that it will be useful,</span>
<span class="c1"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c1"># GNU General Public License for more details.</span>
<span class="c1">#</span>
<span class="c1"># You should have received a copy of the GNU General Public License</span>
<span class="c1"># along with vibrav.  If not, see &lt;https://www.gnu.org/licenses/&gt;.</span>
<span class="kn">from</span> <span class="nn">exatomic.exa.core.numerical</span> <span class="kn">import</span> <span class="n">Series</span>
<span class="kn">from</span> <span class="nn">vibrav.base</span> <span class="kn">import</span> <span class="n">resource</span>

<div class="viewcode-block" id="MissingRequiredInput"><a class="viewcode-back" href="../../../vibrav.core.config.html#vibrav.core.config.MissingRequiredInput">[docs]</a><span class="k">class</span> <span class="nc">MissingRequiredInput</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">pass</span></div>

<div class="viewcode-block" id="Config"><a class="viewcode-back" href="../../../vibrav.core.config.html#vibrav.core.config.Config">[docs]</a><span class="k">class</span> <span class="nc">Config</span><span class="p">(</span><span class="n">Series</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Base class to read the configuration file given at the start of the different Vibrational</span>
<span class="sd">    Averaging modules.</span>

<span class="sd">    Global default values.</span>

<span class="sd">    +-------------------+---------------------------------------------------+----------------+</span>
<span class="sd">    | Attribute         | Description                                       | Default Value  |</span>
<span class="sd">    +===================+===================================================+================+</span>
<span class="sd">    | delta_file        | Filepath of the delta displacement parameters     | delta.dat      |</span>
<span class="sd">    |                   | used to generate the different displaced          |                |</span>
<span class="sd">    |                   | structures.                                       |                |</span>
<span class="sd">    +-------------------+---------------------------------------------------+----------------+</span>
<span class="sd">    | reduced_mass_file | Filepath to the reduced masses of the vibrational | redmass.dat    |</span>
<span class="sd">    |                   | modes.                                            |                |</span>
<span class="sd">    +-------------------+---------------------------------------------------+----------------+</span>
<span class="sd">    | frequency_file    | Filepath of the energies of the normal modes.     | freq.dat       |</span>
<span class="sd">    +-------------------+---------------------------------------------------+----------------+</span>
<span class="sd">    | smatrix_file      | Filepath of the frequency normal mode             | smatrix.dat    |</span>
<span class="sd">    |                   | displacements as a column vector of normalized    |                |</span>
<span class="sd">    |                   | cartesian coordinates in atomic units.            |                |</span>
<span class="sd">    +-------------------+---------------------------------------------------+----------------+</span>
<span class="sd">    | eqcoord_file      | Filepath of the equilibrium coordinates of the    | eqcoord.dat    |</span>
<span class="sd">    |                   | molecule. This is given as a column vector of     |                |</span>
<span class="sd">    |                   | the coordinates in Angstrom units.                |                |</span>
<span class="sd">    +-------------------+---------------------------------------------------+----------------+</span>
<span class="sd">    | atom_order_file   | Filepath of the atomic symbols in the correct     | atom_order.dat |</span>
<span class="sd">    |                   | order as it appears on the XYZ coordinate file.   |                |</span>
<span class="sd">    +-------------------+---------------------------------------------------+----------------+</span>
<span class="sd">    | delta_disp        | Constant displacement parameter to generate the   | 0.0            |</span>
<span class="sd">    |                   | displaced structures. Only matters for the        |                |</span>
<span class="sd">    |                   | `delta_type` parameter for                        |                |</span>
<span class="sd">    |                   | :func:`vibrav.util.gen_displaced.gen_delta` is 3. |                |</span>
<span class="sd">    +-------------------+---------------------------------------------------+----------------+</span>
<span class="sd">    | delta_algorithm   | Delta algorithm used to generate the displaced    | 2              |</span>
<span class="sd">    |                   | structures. This is passed as the `delta_type`    |                |</span>
<span class="sd">    |                   | parameter in                                      |                |</span>
<span class="sd">    |                   | :func:`vibrav.util.gen_displaced.gen_delta`       |                |</span>
<span class="sd">    +-------------------+---------------------------------------------------+----------------+</span>
<span class="sd">    | delta_value       | Normalization parameter used to generate the      | 0.04           |</span>
<span class="sd">    |                   | displaced structures. This is passed as the norm  |                |</span>
<span class="sd">    |                   | parameter in                                      |                |</span>
<span class="sd">    |                   | :func:`vibrav.util.gen_displaced.gen_delta`       |                |</span>
<span class="sd">    +-------------------+---------------------------------------------------+----------------+</span>
<span class="sd">    | freqdx            | Set which frequency indices to calculate. This is | -1             |</span>
<span class="sd">    |                   | a zero based index and can be set with a &#39;-&#39; for  |                |</span>
<span class="sd">    |                   | a range of indices and a &#39;,&#39; or &#39; &#39; for specific  |                |</span>
<span class="sd">    |                   | indices.                                          |                |</span>
<span class="sd">    +-------------------+---------------------------------------------------+----------------+</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">_sname</span> <span class="o">=</span> <span class="s1">&#39;config_file&#39;</span>
    <span class="n">_iname</span> <span class="o">=</span> <span class="s1">&#39;config_elem&#39;</span>
    <span class="n">_default</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;delta_file&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;delta.dat&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>
                <span class="s1">&#39;reduced_mass_file&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;redmass.dat&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>
                <span class="s1">&#39;frequency_file&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;freq.dat&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>
                <span class="s1">&#39;smatrix_file&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;smatrix.dat&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>
                <span class="s1">&#39;eqcoord_file&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;eqcoord.dat&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>
                <span class="s1">&#39;atom_order_file&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;atom_order.dat&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>
                <span class="s1">&#39;delta_disp&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
                <span class="s1">&#39;delta_algorithm&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span>
                <span class="s1">&#39;delta_value&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.04</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
                <span class="s1">&#39;freqdx&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span>
                <span class="s1">&#39;use_resource&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)}</span>

<div class="viewcode-block" id="Config.open_config"><a class="viewcode-back" href="../../../vibrav.core.config.html#vibrav.core.config.Config.open_config">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">open_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">defaults</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">skip_defaults</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Open and read the config file that is given.</span>

<span class="sd">        Args:</span>
<span class="sd">            fp (:obj:`str`): Filepath to the config file.</span>
<span class="sd">            required (:obj:`list`): Required arguments that must be</span>
<span class="sd">                    present in the config file.</span>
<span class="sd">            defaults (:obj:`list`, optional): Default arguments for the</span>
<span class="sd">                    config file that are not necessary. Defaults to</span>
<span class="sd">                    :code:`None`.</span>
<span class="sd">            skip_defaults (:obj:`list`, optional): Skip the given</span>
<span class="sd">                    default arguments. This is helpful for unit testing</span>
<span class="sd">                    as all of the default files may not be available.</span>
<span class="sd">                    Defaults to :code:`None`.</span>

<span class="sd">        Returns:</span>
<span class="sd">            config (:obj:`dict`): Dictionary with all of the elements in the config as keys</span>

<span class="sd">        Raises:</span>
<span class="sd">            AttributeError: When there is more than one value for a</span>
<span class="sd">                    default argument, having more than  one value when</span>
<span class="sd">                    the input dictionaries say it should be one value,</span>
<span class="sd">                    or when there is a missing required parameter.</span>
<span class="sd">            Exception: Default catch when the required parameter is not</span>
<span class="sd">                    interpreted correctly and does not fall within any</span>
<span class="sd">                    of the coded parameters.</span>
<span class="sd">            ValueError: When it cannot set the type that has been given</span>
<span class="sd">                    as an input. I.e. converting string character into a</span>
<span class="sd">                    number.</span>

<span class="sd">        Examples:</span>
<span class="sd">            The usage of this module can be as follows.</span>

<span class="sd">            &gt;&gt;&gt; from vibrav.base import resource</span>
<span class="sd">            &gt;&gt;&gt; config = Config.open_config(resource(&#39;molcas-ucl6-2minus-vibronic-config&#39;), required={})</span>
<span class="sd">            &gt;&gt;&gt; print(config.to_sring())</span>
<span class="sd">            config_elem</span>
<span class="sd">            freq_data_file              [ADF_FREQ_FILE]</span>
<span class="sd">            number_of_multiplicity                  [2]</span>
<span class="sd">            spin_multiplicity                    [3, 1]</span>
<span class="sd">            number_of_states                   [42, 49]</span>
<span class="sd">            number_of_nuclei                        [7]</span>
<span class="sd">            number_of_modes                        [15]</span>
<span class="sd">            delta_algorithm                           0</span>
<span class="sd">            delta_value                            0.04</span>
<span class="sd">            oscillator_spin_states                 [91]</span>
<span class="sd">            delta_file                        delta.dat</span>
<span class="sd">            reduced_mass_file               redmass.dat</span>
<span class="sd">            frequency_file                     freq.dat</span>
<span class="sd">            sf_energies_file          [energies-SF.txt]</span>
<span class="sd">            so_energies_file             [energies.txt]</span>
<span class="sd">            zero_order_file             [ucl-rassi.out]</span>
<span class="sd">            delta_disp                                0</span>
<span class="sd">            &gt;&gt;&gt; print(type(config.number_of_nuclei), type(config.number_of_nuclei[0]))</span>
<span class="sd">            &lt;class &#39;list&#39;&gt; &lt;class &#39;str&#39;&gt;</span>
<span class="sd">            &gt;&gt;&gt; print(type(config.spin_multiplicity), type(config.spin_multiplicity[0]))</span>
<span class="sd">            &lt;class &#39;list&#39;&gt; &lt;class &#39;str&#39;&gt;</span>

<span class="sd">            Any of the items that are not passed as default or required in the `defaults` or `required`</span>
<span class="sd">            parameters respectively will be shown as a list entry as shown in the `number_of_multiplicity`</span>
<span class="sd">            entry in the result from the example above.</span>

<span class="sd">            Now if we pass some required arguments for `number_of_multiplicity`, `spin_multiplicity`,</span>
<span class="sd">            `number_of_states` and `number_of_modes`, as is required in the vibronic coupling calculations</span>
<span class="sd">            from :class:`vibrav.vibronic.Vibronic`, the input is now as follows.</span>

<span class="sd">            &gt;&gt;&gt; from vibrav.base import resource</span>
<span class="sd">            &gt;&gt;&gt; required = {&#39;number_of_multiplicity&#39;: int, &#39;spin_multiplicity&#39;: (tuple, int),</span>
<span class="sd">            ...             &#39;number_of_states&#39;: (tuple, int), &#39;number_of_nuclei&#39;: int}</span>
<span class="sd">            &gt;&gt;&gt; config = Config.open_config(resource(&#39;molcas-ucl6-2minus-vibronic-config&#39;), required=required)</span>
<span class="sd">            &gt;&gt;&gt; print(config.to_sring())</span>
<span class="sd">            config_elem</span>
<span class="sd">            freq_data_file              [ADF_FREQ_FILE]</span>
<span class="sd">            number_of_multiplicity                    2</span>
<span class="sd">            spin_multiplicity                    (3, 1)</span>
<span class="sd">            number_of_states                   (42, 49)</span>
<span class="sd">            number_of_nuclei                          7</span>
<span class="sd">            number_of_modes                        [15]</span>
<span class="sd">            delta_algorithm                           0</span>
<span class="sd">            delta_value                            0.04</span>
<span class="sd">            oscillator_spin_states                 [91]</span>
<span class="sd">            delta_file                        delta.dat</span>
<span class="sd">            reduced_mass_file               redmass.dat</span>
<span class="sd">            frequency_file                     freq.dat</span>
<span class="sd">            sf_energies_file          [energies-SF.txt]</span>
<span class="sd">            so_energies_file             [energies.txt]</span>
<span class="sd">            zero_order_file             [ucl-rassi.out]</span>
<span class="sd">            delta_disp                                0</span>
<span class="sd">            &gt;&gt;&gt; print(type(config.number_of_nuclei))</span>
<span class="sd">            &lt;class &#39;int&#39;&gt;</span>
<span class="sd">            &gt;&gt;&gt; print(type(config.spin_multiplicity), type(config.spin_multiplicity[0]))</span>
<span class="sd">            &lt;class &#39;tuple&#39;&gt; &lt;class &#39;int&#39;&gt;</span>

<span class="sd">            Now the required inputs that we gave the function are of the</span>
<span class="sd">            specified types. The `required` parameter has to take a</span>
<span class="sd">            dictionary where single values in the input file will have a</span>
<span class="sd">            single data type defined in the `required` dictionary.</span>
<span class="sd">            Parameters in the input file with more than one input, such</span>
<span class="sd">            as the &#39;spin_multiplicity&#39; input, will have a :obj:`list` or</span>
<span class="sd">            :obj:`tuple` of data types where the first one defined what</span>
<span class="sd">            type of list-like object it will be and the second parameter</span>
<span class="sd">            is the data type of the individual entries.</span>

<span class="sd">            If additional default values are to be passed, the</span>
<span class="sd">            `defaults` parameter must be used. We will create a new</span>
<span class="sd">            dummy argument, `test`, that will default to `&#39;Hi I am a</span>
<span class="sd">            string&#39;` as a :obj:`str`.</span>

<span class="sd">            &gt;&gt;&gt; from vibrav.base import resource</span>
<span class="sd">            &gt;&gt;&gt; required = {&#39;number_of_multiplicity&#39;: int, &#39;spin_multiplicity&#39;: (tuple, int),</span>
<span class="sd">            ...             &#39;number_of_states&#39;: (tuple, int), &#39;number_of_nuclei&#39;: int}</span>
<span class="sd">            &gt;&gt;&gt; new_default = {&#39;test&#39;: (&#39;&#39;, str)}</span>
<span class="sd">            &gt;&gt;&gt; config = Config.open_config(resource(&#39;molcas-ucl6-2minus-vibronic-config&#39;), required=required, defaults=new_default)</span>
<span class="sd">            &gt;&gt;&gt; print(config.to_sring())</span>
<span class="sd">            config_elem</span>
<span class="sd">            freq_data_file              [ADF_FREQ_FILE]</span>
<span class="sd">            number_of_multiplicity                    2</span>
<span class="sd">            spin_multiplicity                    (3, 1)</span>
<span class="sd">            number_of_states                   (42, 49)</span>
<span class="sd">            number_of_nuclei                          7</span>
<span class="sd">            number_of_modes                        [15]</span>
<span class="sd">            delta_algorithm                           0</span>
<span class="sd">            delta_value                            0.04</span>
<span class="sd">            oscillator_spin_states                 [91]</span>
<span class="sd">            delta_file                        delta.dat</span>
<span class="sd">            reduced_mass_file               redmass.dat</span>
<span class="sd">            frequency_file                     freq.dat</span>
<span class="sd">            sf_energies_file          [energies-SF.txt]</span>
<span class="sd">            so_energies_file             [energies.txt]</span>
<span class="sd">            zero_order_file             [ucl-rassi.out]</span>
<span class="sd">            test                       Hi I am a string</span>
<span class="sd">            delta_disp                                0</span>
<span class="sd">            &gt;&gt;&gt; print(type(config.test))</span>
<span class="sd">            &lt;class &#39;str&#39;&gt;</span>

<span class="sd">            We can see that we have added a default argument to the</span>
<span class="sd">            input file that is called `test` with a :obj:`str` value of</span>
<span class="sd">            `&#39;Hi I am a string&#39;`. The format of the default parameter</span>
<span class="sd">            that must be given is a dictionary where every value is a</span>
<span class="sd">            :obj:`tuple` of 2 objects. The first one defines the default</span>
<span class="sd">            value, the second one defines the data type of the default</span>
<span class="sd">            value.</span>

<span class="sd">            Any other input that is not defined as a default or required</span>
<span class="sd">            argument is saved in the config object as a :obj;`list` of</span>
<span class="sd">            string/s. An example if the `freq_data_file` input in the</span>
<span class="sd">            above examples. These are saved in case they are needed</span>
<span class="sd">            later on rather than being deleted as a whole.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fn</span><span class="p">:</span>
            <span class="c1"># get the lines and replace all newline characters</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span> <span class="n">fn</span><span class="o">.</span><span class="n">readlines</span><span class="p">()))</span>
        <span class="c1"># update the defaults dict with the given defaults</span>
        <span class="k">if</span> <span class="n">defaults</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">defaults</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_default</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">defaults</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_default</span>
        <span class="k">if</span> <span class="n">skip_defaults</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">skip_defaults</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">config</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">found_defaults</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">found_required</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="c1"># get the data on the line and deal with whitespace</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span> <span class="k">continue</span>
            <span class="c1"># ignore &#39;#&#39; as comments</span>
            <span class="k">elif</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;#&#39;</span><span class="p">:</span> <span class="k">continue</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
            <span class="c1"># start by checking if the key is a default value</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">found_defaults</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="c1"># for default values currently they should only have a single entry</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;Got the wrong number of entries in </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># try to set the type of default value</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">defaults</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="nb">bool</span><span class="p">:</span>
                            <span class="n">config</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaults</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">1</span><span class="p">](</span><span class="nb">int</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">config</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaults</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">1</span><span class="p">](</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> \
                                         <span class="o">+</span> <span class="s1">&#39; when reading </span><span class="si">{}</span><span class="s1"> in configuration file&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
            <span class="c1"># check for the required inputs given as a parameter</span>
            <span class="c1"># this allows us to use this script in the different ways we need it and we just</span>
            <span class="c1"># pass it the parameters that are required for that specific calculation</span>
            <span class="c1"># it is not pretty but I think it is the most generalized way to do this</span>
            <span class="k">elif</span> <span class="n">required</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">required</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">found_required</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                    <span class="c1"># make sure if the entry will need to be iterated over</span>
                    <span class="c1"># this must be specified by giving a two element required param. value in the dict</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">required</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                        <span class="n">config</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">required</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span>
                    <span class="c1"># when the requirement value passed is not two elements but the data on the</span>
                    <span class="c1"># config file has more than one element</span>
                    <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">required</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;Found more than one element in input although it is &quot;</span> \
                                            <span class="o">+</span><span class="s2">&quot;expected to be a single value&quot;</span><span class="p">)</span>
                    <span class="c1"># for a single element input</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">config</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">required</span><span class="p">[</span><span class="n">key</span><span class="p">](</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="c1"># if all else fails</span>
                    <span class="c1"># this should never execute</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Failed when trying to determine the data &quot;</span> \
                                        <span class="o">+</span><span class="s2">&quot;type of the required key.&quot;</span><span class="p">)</span>
            <span class="c1"># all other inputs</span>
            <span class="c1"># TODO: make some extras input thing that will take care of these</span>
            <span class="c1">#       we do not want to throw them out as it may be useful at some point</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">config</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">if</span> <span class="n">required</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># check for missing required arguments</span>
            <span class="n">missing_required</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">found_required</span><span class="p">,</span> <span class="n">required</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
            <span class="k">if</span> <span class="n">missing_required</span><span class="p">:</span>
                <span class="n">miss_text</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> - &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">missing_required</span><span class="p">)</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;We are missing the following parameters in the &quot;</span> \
                      <span class="o">+</span><span class="s2">&quot;input file: </span><span class="si">{}</span><span class="s2">&quot;</span>
                <span class="k">raise</span> <span class="n">MissingRequiredInput</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">miss_text</span><span class="p">))</span>
        <span class="c1"># check for missing default arguments and fill in with the default values</span>
        <span class="c1"># availabel in the defaults dict</span>
        <span class="n">missing_default</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">found_defaults</span><span class="p">,</span>
                                      <span class="n">defaults</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="k">for</span> <span class="n">missing</span> <span class="ow">in</span> <span class="n">missing_default</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">missing</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">skip_defaults</span><span class="p">:</span>
                <span class="n">config</span><span class="p">[</span><span class="n">missing</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaults</span><span class="p">[</span><span class="n">missing</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;use_resource&#39;</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">config</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="s1">&#39;_file&#39;</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                        <span class="n">config</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">resource</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">val</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">config</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">resource</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">config</span><span class="p">)</span></div></div>

</pre></div>

    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2023, Herbert D Ludowieg. Project structure based on the Computational Molecular Science Python Cookiecutter version 1.1.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 7.0.1.<br/>
    </p>
  </div>
</footer>
  </body>
</html>